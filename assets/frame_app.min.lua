-- Frame Audio Streaming Application (Minified)
-- This script runs on the Frame device and handles audio streaming
local data=require('data')local MSG_TYPE={START_AUDIO=1,STOP_AUDIO=2,AUDIO_CHUNK=3}local streaming_active=false;local sample_rate=16000;local bit_depth=8;local function stream_audio()local mtu=frame.bluetooth.max_length()local chunk_size=mtu-8;while streaming_active do local audio_data=frame.microphone.read(chunk_size)if audio_data==nil then streaming_active=false;break end;if audio_data~=''then data.send_message(MSG_TYPE.AUDIO_CHUNK,audio_data)else frame.sleep(0.001)end end;frame.microphone.stop()end;local function app_loop()print("Frame audio app ready")while true do if data.process_raw_items()>0 then local msg_type,msg_payload=data.get_message()if msg_type==MSG_TYPE.START_AUDIO then if not streaming_active then if msg_payload and#msg_payload>=4 then sample_rate=(msg_payload:byte(1)|(msg_payload:byte(2)<<8))bit_depth=msg_payload:byte(3)end;frame.microphone.start{sample_rate=sample_rate,bit_depth=bit_depth}streaming_active=true;stream_audio()end elseif msg_type==MSG_TYPE.STOP_AUDIO then streaming_active=false end end;frame.sleep(0.001)end end;app_loop()
